"use strict";angular.module("starBattlesClientPrototypeApp",["ngCookies","ngResource","ngRoute","starBattlesClientPrototypeApp.directives","btford.socket-io","audioPlayer"]).factory("socket",["socketFactory",function(a){var b=io.connect("http://musique.pp.ua:80/"),c=a({ioSocket:b});return c}]).run(["$rootScope","$location","$routeParams",function(a,b,c){a.$on("$routeChangeSuccess",function(){console.log("Current route name: "+b.path()),console.log(c)});var d={login:"lwh",loggedIn:!0,signOut:function(){this.loggedIn=!1},signIn:function(){this.loggedIn=!0},isLoggedIn:function(){return this.loggedIn}};a.user=d,a.currentTrack={}}]).config(["$routeProvider","$sceDelegateProvider",function(a,b){b.resourceUrlWhitelist(["self","**"]),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/player",{templateUrl:"views/player.html",controller:"PlayerCtrl"}).when("/fleet",{templateUrl:"views/fleet.html",controller:"FleetCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("d3",[]).factory("d3Service",["$document","$q","$rootScope",function(a,b,c){function d(){c.$apply(function(){e.resolve(window.d3)})}var e=b.defer(),f=a[0].createElement("script");f.type="text/javascript",f.async=!0,f.src="bower_components/d3/d3.js",f.onreadystatechange=function(){"complete"==this.readyState&&d()},f.onload=d;var g=a[0].getElementsByTagName("body")[0];return g.appendChild(f),{d3:function(){return e.promise}}}]),angular.module("starBattlesClientPrototypeApp.directives",["d3"]).directive("map",["d3Service",function(a){return{restrict:"EA",scope:{val:"="},link:function(b,c){a.d3().then(function(a){function d(a){return a.size}function e(){return 1}function f(b){var c=i/b.dx,d=j/b.dy;k.domain([b.x,b.x+b.dx]),l.domain([b.y,b.y+b.dy]);var e=o.selectAll("g.cell").transition().duration(a.event.altKey?7500:750).attr("transform",function(a){return"translate("+k(a.x)+","+l(a.y)+")"});e.select("rect").attr("width",function(a){return c*a.dx-1}).attr("height",function(a){return d*a.dy-1}),e.select("text").attr("x",function(a){return c*a.dx/2}).attr("y",function(a){return d*a.dy/2}).style("opacity",function(a){return c*a.dx>a.w?1:0}),h=b,a.event.stopPropagation()}var g,h,i=1200,j=620,k=a.scale.linear().range([0,i]),l=a.scale.linear().range([0,j]),m=a.scale.category20c(),n=a.layout.treemap().round(!1).size([i,j]).sticky(!0).value(function(a){return a.size}),o=a.select(c[0]).append("svg").attr("class","chart").style("width",i+"px").style("height",j+"px").append("svg:svg").attr("width",i).attr("height",j).append("svg:g").attr("transform","translate(.5,.5)");window.onresize=function(){b.$apply()},b.data=[{name:"Greg",score:98},{name:"Ari",score:96},{name:"Q",score:75},{name:"Loser",score:48}],b.$watch(function(){},function(){b.render(b.data)}),console.log(a),b.render=function(){a.json("scripts/flare.json",function(b){console.log(b),h=g=b;var c=n.nodes(g).filter(function(a){return!a.children}),i=o.selectAll("g").data(c).enter().append("svg:g").attr("class","cell").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).on("click",function(a){return f(h==a.parent?g:a.parent)});i.append("svg:rect").attr("width",function(a){return a.dx-1}).attr("height",function(a){return a.dy-1}).style("fill",function(a){return m(a.parent.name)}),i.append("svg:text").attr("x",function(a){return a.dx/2}).attr("y",function(a){return a.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(a){return a.name}).style("opacity",function(a){return a.w=this.getComputedTextLength(),a.dx>a.w?1:0}),a.select(window).on("click",function(){f(g)}),a.select("select").on("change",function(){n.value("size"==this.value?d:e).nodes(g),f(h)})})}})}}}]),angular.module("starBattlesClientPrototypeApp").controller("MainCtrl",["$scope",function(){}]),angular.module("starBattlesClientPrototypeApp").controller("NavigationCtrl",["$scope",function(){}]),angular.module("starBattlesClientPrototypeApp").controller("AboutCtrl",["$scope",function(){}]),angular.module("starBattlesClientPrototypeApp").controller("LoginCtrl",["$scope",function(){}]),angular.module("starBattlesClientPrototypeApp").controller("PlayerCtrl",["$scope","$rootScope","socket",function(a,b,c){a.search=null;var d=function(a){console.log(a),a&&c.emit("search-tracks",{query:a},function(a){console.log("PlayerCtrl - search-tracks - data",a)})};c.forward("search-tracks-result",a),a.$on("socket:search-tracks-result",function(b,c){console.log("PlayerCtrl - search-tracks-results - ev",b),console.log("PlayerCtrl - search-tracks-results - data",c),c.success&&(a.tracks=c.tracks)});var e=function(){var b=a.queue.shift(),d=b.id;c.emit("get-track-link",{trackId:d},function(a){console.log("PlayerCtrl - get-track-link - data",a)})};a.playQueue=e,a.getTracks=d,c.forward("get-track-link-result",a),a.$on("socket:get-track-link-result",function(a,c){console.log("PlayerCtrl - get-track-link-results - ev",a),console.log("PlayerCtrl - get-track-link-results - data",c),c.success&&(b.currentTrack=c.track)}),a.queue=[];var f=function(b){var c=null;for(var d in a.tracks)if(a.tracks[d].id===b){c=a.tracks[d];break}if(console.log(c),c){for(var e in a.queue)if(a.queue[e].id===b)return;c.rating=0,a.queue.push(c)}},g=function(b){var c=null;for(var d in a.queue)if(a.queue[d].id===b){c=a.queue[d];break}console.log(c),c&&a.queue[d].rating++},h=function(b){var c=null;for(var d in a.queue)if(a.queue[d].id===b){c=a.queue[d];break}console.log(c),c&&c.rating>0&&a.queue[d].rating--},i=function(b){var c=null;for(var d in a.queue)if(a.queue[d].id===b){c=a.queue[d];break}console.log(c),c&&delete a.queue[d]};a.addTrackToQueue=f,a.upVote=g,a.downVote=h,a.removeTrackFromQueue=i,a.$on("ended",function(a,c){console.log("PlayerCtrl - get-track-link-results - ev",a),console.log("PlayerCtrl - get-track-link-results - data",c),c.success&&(b.currentTrack=c.track)})}]),angular.module("starBattlesClientPrototypeApp").controller("ProfileCtrl",["$scope","$rootScopefunction",function(a,b){a.user=b.user}]);